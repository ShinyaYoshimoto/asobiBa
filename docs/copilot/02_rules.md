# 02_rules — 高レベル振る舞いルール（必須）

目的
- リポジトリ全体で守るべき振る舞いルールを明確化します。Copilot からの提案は必ず人のレビューを前提としてください。

必須ルール
- 破壊的変更禁止: 既存の public API、型、Prisma の DB スキーマに対する破壊的変更は基本的に行わない。大きな変更は「提案（diff + 互換性維持案）」として出力すること。
- 生成物の扱い: Prisma client 等の生成済みファイルや src/generated 以下の自動生成物は直接編集しない。変更が必要な場合は schema を修正し、prisma:generate を実行する手順を提示すること。
- シークレット禁止: API キーや秘密情報をコードにハードコードしない。サンプルは .env.example または README に示し、実鍵は環境変数／Secrets を使う案のみ提示する。
- any 禁止: any 型の濫用を避け、やむを得ない場合は明確な理由と TODO コメントを付与する。
- テスト必須: 機能追加や修正には必ずユニットテスト（vitest/jest に合わせる）を追加する。テストファースト（TDD）を推奨する。
- 出力差分: 変更を提案する場合は unified diff 形式でファイル単位の差分を示すこと。

運用上の注意
- 変更による影響範囲を明記: どのパッケージに影響するかを必ず列挙し、互換性リスクがあれば代替案を示すこと。
- 自動マージ禁止: Copilot に自動でマージする権限を与えない。出力は常に人の確認と CI を前提とする。
- 依存関係: 依存パッケージ（特に @asobiba/common）の型変更は影響範囲が大きいため、影響先でのビルド・テスト手順を合わせて提示すること。

例外
- ドキュメントのみの変更など、テスト不要と判断される小さな変更は例外となり得るが、その旨を明記すること。
